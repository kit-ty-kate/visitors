\documentclass[onecolumn,11pt,nocopyrightspace]{sigplanconf}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[bookmarks=true,bookmarksopen=true,colorlinks=true,%
            linkcolor=blue,citecolor=blue,urlcolor=blue]{hyperref}
\usepackage{listings}
\input{listings-ocaml}
\lstset{language=ocaml}
\usepackage{xcolor}
\usepackage{mdframed}
\usepackage{xspace}
\input{macros}

% ------------------------------------------------------------------------------
% Headings.

\title{Visitors}

\begin{document}
\authorinfo{Fran√ßois Pottier}{Inria Paris}{francois.pottier@inria.fr}
\maketitle

% ------------------------------------------------------------------------------

% TEMPORARY
\clearpage
% \tableofcontents
% \clearpage

% ------------------------------------------------------------------------------

\section{Introduction}

\subsection{Setup}

In order to install the \visitors package, an \opam user should issue the
following commands:
\begin{verbatim}
  opam update
  opam install visitors
\end{verbatim}
In order to use the \visitors package, an \ocamlbuild user should add the
following line in her project's \texttt{\_tags} file:
\begin{lstlisting}
  true: package(visitors.ppx), package(visitors.runtime)
\end{lstlisting}
Furthermore, a Merlin user should add the following lines in her project's
\texttt{.merlin} file:
\begin{lstlisting}
  PKG visitors.ppx
  PKG visitors.runtime
\end{lstlisting}

\subsection{Tutorial}

% ------------------------------------------------------------------------------

\begin{figure}[t]
In an OCaml source code file, a type definition can be annotated with
\texttt{[@@deriving visitors { ... }]}:
\orig{expr00}
This causes the following code to be (invisibly) generated:
\processed{expr00}
\caption{An \texttt{iter}-style visitor}
\label{fig:expr00}
\end{figure}

Suppose we wish to work with arithmetic expressions built out of integer
literals and binary additions. An algebraic data type \oc|expr| is shown in
the first part of \fref{fig:expr00}. By annotating this type definition with
\texttt{[@@deriving visitors { ... }]}, we request the automated generation of
a visitor for expressions. The code for this visitor, which normally remains
invisible, is shown in the second part of \fref{fig:expr00}.

The annotation \texttt{[@@deriving visitors { ... }]} must carry at least two
parameters. The parameter \name can be an arbitrary string; it is used as the
name of the generated class. The parameter \variety must be one of \iter,
\map, \itertwo, \maptwo. It indicates which visitor template must be used.

% ------------------------------------------------------------------------------

\begin{figure}[t]
\orig{expr01}
\vspace{-\baselineskip}
\processed{expr01}
\caption{A \texttt{map}-style visitor}
\label{fig:expr01}
\end{figure}

% ------------------------------------------------------------------------------

\begin{figure}[t]
\orig{expr02}
\vspace{-\baselineskip}
\processed{expr02}
\caption{An \texttt{iter2}-style visitor}
\label{fig:expr02}
\end{figure}

% ------------------------------------------------------------------------------

\begin{figure}[t]
\orig{expr03}
\vspace{-\baselineskip}
\processed{expr03}
\caption{A \texttt{map2}-style visitor}
\label{fig:expr03}
\end{figure}

% ------------------------------------------------------------------------------

\end{document}
