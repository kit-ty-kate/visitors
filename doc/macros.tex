% ------------------------------------------------------------------------------
% Including a source code file foo.ml:
%   \orig{foo}

\mdfsetup{%
  linewidth=0pt,%
  skipabove=\baselineskip,%
  skipbelow=.4\baselineskip,%
  innertopmargin=0pt,%
  innerbottommargin=0pt,%
}

\newenvironment{origenv}{%
  \begin{mdframed}[backgroundcolor=gray!10]%
}{%
  \end{mdframed}%
}

\newcommand{\orig}[1]{%
\begin{origenv}
\lstinputlisting{#1.ml}
\end{origenv}
}

\newcommand{\origfirstline}[2]{%
\begin{origenv}
\lstinputlisting[firstline=#2]{#1.ml}
\end{origenv}
}

%% \newcommand{\codefollowupgeneral}[1]{%
%% \begin{center}
%% (This code fragment follows up on #1.)
%% \end{center}
%% \vspace{-\baselineskip}
%% }

\newcommand{\codefollowupgeneral}[1]{%
\marginnote{\footnotesize This follows #1.}[5mm]%
}

\newcommand{\codefollowup}[1]{%
  \codefollowupgeneral{\fref{fig:#1}}%
}

% ------------------------------------------------------------------------------
% Including the corresponding auto-generated code:
%   \processed{foo}

\newenvironment{processedenv}{%
  \begin{mdframed}[backgroundcolor=yellow!40]%
}{%
  \end{mdframed}%
}

\newcommand{\processed}[1]{%
\begin{processedenv}
\lstinputlisting{#1.processed.ml}
\end{processedenv}
}

% ------------------------------------------------------------------------------
% Various macros.

\newcommand{\fref}[1]{Figure~\ref{#1}}
\newcommand{\sref}[1]{\S\ref{#1}}
\newcommand{\email}[1]{\href{mailto:#1}{\texttt{#1}}}

% ------------------------------------------------------------------------------
% Abbreviations.

\newcommand{\merlin}{\href{https://github.com/ocaml/merlin}{Merlin}\xspace}
\newcommand{\ocamlbuild}{\href{https://github.com/ocaml/ocamlbuild/blob/master/manual/manual.adoc}{\texttt{ocamlbuild}}\xspace}
\newcommand{\opam}{\href{https://opam.ocaml.org/}{\texttt{opam}}\xspace}
\newcommand{\ppxderiving}{\href{https://github.com/whitequark/ppx_deriving}{\texttt{ppx\_deriving}}\xspace}

\newcommand{\hashconsRepoURL}{https://github.com/backtracking/ocaml-hashcons}
\newcommand{\hashcons}{\href{\hashconsRepoURL}{\texttt{hashcons}}\xspace}
\newcommand{\hashconsRepoFile}[1]{\href{\hashconsRepoURL/blob/master/#1}{\texttt{#1}}}

\newcommand{\repoURL}{https://gitlab.inria.fr/fpottier/visitors}
\newcommand{\srcFile}[1]{\href{\repoURL/blob/master/src/#1}{\texttt{#1}}}

\newcommand{\iter}{\texttt{iter}\xspace}
\newcommand{\map}{\texttt{map}\xspace}
\newcommand{\itertwo}{\texttt{iter2}\xspace}
\newcommand{\maptwo}{\texttt{map2}\xspace}
\newcommand{\name}{\texttt{name}\xspace}
\newcommand{\unit}{\texttt{unit}\xspace}
\newcommand{\variety}{\texttt{variety}\xspace}
\newcommand{\visitors}{\texttt{visitors}\xspace}
\newcommand{\nonlocal}{\texttt{nonlocal}\xspace}

\newcommand{\tyconvisitor}[1]{\texttt{visit\_#1}}
\newcommand{\dataconvisitor}[1]{\texttt{visit\_#1}}
\newcommand{\tyconfail}[1]{\texttt{fail\_#1}}
